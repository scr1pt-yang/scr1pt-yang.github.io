(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{467:function(s,t,n){"use strict";n.r(t);var a=n(2),e=Object(a.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("hr"),s._v(" "),t("h2",{attrs:{id:"一、nginx负载均衡实现原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一、nginx负载均衡实现原理"}},[s._v("#")]),s._v(" 一、Nginx负载均衡实现原理")]),s._v(" "),t("p",[s._v("随着互联网信息的爆炸性增长，负载均衡（load balance）已经不再是一个很陌生的话题，顾名思义，负载均衡即是将负载分摊到不同的服务单元，既保证服务的可用性，又保证响应足够快，给用户很好的体验。快速增长的访问量和数据流量催生了各式各样的负载均衡产品， 很多专业的负载均衡硬件提供了很好的功能，但却价格不菲，这使得负载均衡软件大受欢迎， nginx 就是其中的一个，在 linux 下有 Nginx、LVS、Haproxy 等等服务可以提供负载均衡服务，而且 Nginx 提供了几种分配方式(策略)："),t("br"),s._v(" "),t("strong",[s._v("①轮询（默认）")]),t("br"),s._v("\n每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器 down 掉，能自动剔除。"),t("br"),s._v(" "),t("strong",[s._v("②weight（权重）")]),t("br"),s._v("\nweight 代表权重默认为 1，权重越高被分配的客户端请求越多。"),t("br"),s._v("\n指定轮询几率，weight 和访问比率成正比，用于后端服务器性能不均的情况。 例如：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("upstream server_pool"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  \tserver "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".139.27\t\t\tweight "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \tserver "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".139.28\t\t\tweight "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[t("strong",[s._v("③ip_hash")]),t("br"),s._v("\n每个请求按访问 ip 的 hash 结果分配，这样每个访客固定访问一个后端服务器，可以解决 session 的问题。例如：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("upstream server_pool"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  \tip_hash"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \tserver "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".139.27"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \tserver "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".139.28"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[t("strong",[s._v("④fair（第三方）")]),t("br"),s._v("\n按后端服务器的响应时间来分配请求，响应时间短的优先分配。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("upstream server_pool"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  \tserver "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".139.27"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \tserver "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".139.28"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \tfair"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h2",{attrs:{id:"二、nginx负载均衡配置实例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二、nginx负载均衡配置实例"}},[s._v("#")]),s._v(" 二、Nginx负载均衡配置实例")]),s._v(" "),t("p",[s._v("实现效果：浏览器地址栏输入地址 "),t("code",[s._v("http://192.168.139.27/edu/a.html")]),s._v("，负载均衡效果，平均 8080 和 8081 端口中")]),s._v(" "),t("h3",{attrs:{id:"_1、准备工作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、准备工作"}},[s._v("#")]),s._v(" 1、准备工作")]),s._v(" "),t("p",[s._v("准备两台tomcat服务器，一台开放8080端口，一台开放8081端口，在两台tomcat里面的webapps目录下创建edu文件夹，在edu文件下创建页面a.html。")]),s._v(" "),t("h3",{attrs:{id:"_2、配置nginx负载均衡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、配置nginx负载均衡"}},[s._v("#")]),s._v(" 2、配置nginx负载均衡")]),s._v(" "),t("p",[s._v("找到"),t("code",[s._v("/usr/local/nginx/conf/nginx.conf")]),s._v("配置文件，进行如下配置：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("upstream myserver{\n  \tserver 192.168.139.27:8080;\n  \tserver 192.168.139.27:8081;\n}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("server {\n\t\tlisten\t\t80;\n\t\tserver_name\t\t192.168.139.27;   ##指定服务器IP地址\n\n\t\tlocation / {\n\t\t\t\tproxy_pass\t\thttp://myserver;\t##指定前边定义的myserver，将请求负载分担到myserver中的IP和端口上\n      \troot\t\thtml;\n      \tindex\t\tindex.html index.htm; \t\n\t\t}\n}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("测试：使用浏览器访问"),t("code",[s._v("http://192.168.139.27/edu/a.html")]),s._v("，一直刷新页面，会发现有时响应结果为8080端口tomcat的页面内容，有时响应结果为8081端口tomcat的页面内容，nginx已将请求负载均衡到两台tomcat服务器。")])])}),[],!1,null,null,null);t.default=e.exports}}]);